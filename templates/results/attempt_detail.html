{% extends 'base.html' %}

{% block title %}Résultats du quiz - SOUKLOU{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Results Header -->
    <div class="bg-white rounded-xl shadow-md p-8 mb-6">
        <div class="text-center mb-6">
            <div class="inline-block p-6 rounded-full {% if attempt.passed %}bg-green-100{% else %}bg-red-100{% endif %} mb-4">
                <span class="text-5xl font-bold {% if attempt.passed %}text-green-600{% else %}text-red-600{% endif %}">
                    {{ attempt.score|floatformat:1 }}%
                </span>
            </div>
            <h1 class="text-3xl font-bold mb-2">
                {% if attempt.passed %}Félicitations !{% else %}Continuez vos efforts !{% endif %}
            </h1>
            <p class="text-gray-600">{{ attempt.fiche.title }}</p>
        </div>

        <div class="grid grid-cols-3 gap-6 text-center">
            <div class="bg-gray-50 p-4 rounded-lg">
                <p class="text-gray-600 text-sm mb-1">Questions</p>
                <p class="text-2xl font-bold">{{ attempt.total_questions }}</p>
            </div>
            <div class="bg-green-50 p-4 rounded-lg">
                <p class="text-green-700 text-sm mb-1">Correctes</p>
                <p class="text-2xl font-bold text-green-600">{{ attempt.correct_answers }}</p>
            </div>
            <div class="bg-red-50 p-4 rounded-lg">
                <p class="text-red-700 text-sm mb-1">Incorrectes</p>
                <p class="text-2xl font-bold text-red-600">{{ attempt.total_questions|add:"-"|add:attempt.correct_answers }}</p>
            </div>
        </div>
    </div>

    <!-- Detailed Answers -->
    <div class="bg-white rounded-xl shadow-md p-8">
        <h2 class="text-2xl font-bold mb-6">Détails des réponses</h2>
        <div class="space-y-6">
            {% for qa in question_answers %}
            <div class="border-l-4 {% if qa.is_correct %}border-green-500{% else %}border-red-500{% endif %} pl-4 py-2">
                <div class="flex items-start justify-between mb-2">
                    <h3 class="font-semibold text-lg">{{ qa.question.text }}</h3>
                    {% if qa.is_correct %}
                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">✓ Correct</span>
                    {% else %}
                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold">✗ Incorrect</span>
                    {% endif %}
                </div>
                <div class="mt-3 space-y-2">
                    <p class="text-sm">
                        <span class="font-medium">Votre réponse:</span>
                        <span class="{% if qa.is_correct %}text-green-600{% else %}text-red-600{% endif %}">
                            {{ qa.selected_answer.text }}
                        </span>
                    </p>
                    {% if not qa.is_correct %}
                    <p class="text-sm">
                        <span class="font-medium">Bonne réponse:</span>
                        <span class="text-green-600">{{ qa.question.get_correct_answer.text }}</span>
                    </p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="mt-6 flex justify-center space-x-4">
        <a href="{% url 'fiches:detail' attempt.fiche.pk %}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition">
            Retour à la fiche
        </a>
        <a href="{% url 'quizzes:take_quiz' attempt.fiche.pk %}" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition">
            Refaire le quiz
        </a>
    </div>
</div>
{% endblock %}
